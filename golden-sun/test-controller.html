<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controller Test - Golden Sun</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #1a1a2a;
      color: white;
    }
    
    .test-area {
      max-width: 800px;
      margin: 0 auto;
    }
    
    h1 {
      color: #ffd87f;
    }
    
    .status {
      background: #2a2a3a;
      border: 2px solid #d4a857;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .status-item {
      margin: 10px 0;
      padding: 10px;
      background: #1a1a2a;
      border-radius: 4px;
    }
    
    .button-test {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 20px 0;
    }
    
    .test-button {
      padding: 20px;
      background: #3a3a4a;
      border: 2px solid #5a5a6a;
      border-radius: 8px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .test-button:active {
      background: #5a5a7a;
      transform: scale(0.95);
    }
    
    .test-button.pressed {
      background: #4a9a4a;
      border-color: #6aba6a;
    }
    
    .log {
      background: #0a0a1a;
      border: 2px solid #3a3a4a;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #d4a857;
      padding-left: 10px;
    }
    
    .success {
      color: #4afa4a;
    }
    
    .error {
      color: #fa4a4a;
    }
    
    .info {
      color: #4a9afa;
    }
  </style>
</head>
<body>
  <div class="test-area">
    <h1>üéÆ Controller Button Test</h1>
    <p>This tests the button event handlers in isolation.</p>
    
    <div class="status">
      <h2>Status</h2>
      <div class="status-item">
        <strong>Last Button:</strong> <span id="lastButton">None</span>
      </div>
      <div class="status-item">
        <strong>Press Count:</strong> <span id="pressCount">0</span>
      </div>
      <div class="status-item">
        <strong>Touch Support:</strong> <span id="touchSupport">Checking...</span>
      </div>
    </div>
    
    <h2>Touch These Buttons</h2>
    <div class="button-test">
      <button class="test-button" data-key="ArrowUp">‚Üë<br>D-Pad Up</button>
      <button class="test-button" data-key="ArrowDown">‚Üì<br>D-Pad Down</button>
      <button class="test-button" data-key="ArrowLeft">‚Üê<br>D-Pad Left</button>
      <button class="test-button" data-key="ArrowRight">‚Üí<br>D-Pad Right</button>
      <button class="test-button" data-key="Enter">A<br>Interact</button>
      <button class="test-button" data-key="Escape">B<br>Cancel</button>
      <button class="test-button" data-key="KeyX">X<br>Action</button>
      <button class="test-button" data-key="KeyY">Y<br>Action</button>
    </div>
    
    <h2>Event Log</h2>
    <div class="log" id="log"></div>
    
    <button onclick="clearLog()" style="margin-top: 10px; padding: 10px 20px; background: #d4a857; border: none; border-radius: 4px; cursor: pointer;">
      Clear Log
    </button>
  </div>

  <script>
    let pressCount = 0;
    const lastButton = document.getElementById('lastButton');
    const pressCountEl = document.getElementById('pressCount');
    const touchSupport = document.getElementById('touchSupport');
    const log = document.getElementById('log');
    
    // Check touch support
    const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
    touchSupport.textContent = hasTouch ? '‚úÖ Touch Supported' : '‚ùå No Touch (Use Mouse)';
    touchSupport.className = hasTouch ? 'success' : 'error';
    
    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toISOString().split('T')[1].slice(0, -1)}] ${message}`;
      log.insertBefore(entry, log.firstChild);
      
      // Keep only last 50 entries
      while (log.children.length > 50) {
        log.removeChild(log.lastChild);
      }
    }
    
    function clearLog() {
      log.innerHTML = '';
      addLog('Log cleared', 'info');
    }
    
    function handleButtonPress(key, eventType) {
      pressCount++;
      lastButton.textContent = key;
      pressCountEl.textContent = pressCount;
      
      addLog(`${eventType}: ${key}`, 'success');
      
      // Visual feedback
      const button = document.querySelector(`[data-key="${key}"]`);
      if (button) {
        button.classList.add('pressed');
        setTimeout(() => button.classList.remove('pressed'), 200);
      }
      
      // Simulate what the game would do
      if (key === 'Enter') {
        addLog('‚Üí Game Action: Try Interact / Advance Dialogue', 'info');
      } else if (key === 'Escape') {
        addLog('‚Üí Game Action: Cancel / Close Menu', 'info');
      } else if (key.startsWith('Arrow')) {
        addLog(`‚Üí Game Action: Move ${key.replace('Arrow', '')}`, 'info');
      }
    }
    
    // Add event listeners to all buttons
    document.querySelectorAll('.test-button').forEach(button => {
      const key = button.getAttribute('data-key');
      
      // Touch events
      button.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleButtonPress(key, 'TouchStart');
      });
      
      button.addEventListener('touchend', (e) => {
        e.preventDefault();
        addLog(`TouchEnd: ${key}`, 'info');
      });
      
      // Mouse events (fallback)
      button.addEventListener('mousedown', (e) => {
        e.preventDefault();
        handleButtonPress(key, 'MouseDown');
      });
      
      button.addEventListener('mouseup', (e) => {
        e.preventDefault();
        addLog(`MouseUp: ${key}`, 'info');
      });
    });
    
    addLog('Controller test initialized', 'success');
    addLog(`Device: ${navigator.userAgent}`, 'info');
  </script>
</body>
</html>
